<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order confirmation</title>
    <link rel="stylesheet" href="./css/order.css">
    <link rel="stylesheet" href="./css/order_confirm.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div id="header" class="header_top">
                <nav class="nav">
                    <div class="nav_logo">
                        <h2 class="logo">
                            <a href="login_main.html">The Ratatoille Tech</a>
                        </h2>
                    </div>
                    <ul class="nav_list">
                        <li><a href="login_main.html">Главная страница</a></li>
                        <li><a href="#!">Как это работает</a></li>
                        <li><a href="#!">Крысы</a></li>
                        <li><a href="#!">Почему мы?</a></li>
                        <li><a href="#!">Отзывы</a></li>
                    </ul>
                    <ul class="nav_login">
                        <li><a href="#!" class="btn">Личный кабинет</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    <div class="container">
        <div class="title_row">
        <div><h1 class="header_title">Подтверждение и оплата</h1></div>
        <div><a href="order.html" style="text-decoration: underline">Вернуться к оформлению заказа</a></div>
        </div>
        <div class="order_column">
            <div><h2>№ Заказа</h2><p id="orderNumber"></p></div>
            <div><h2>Состав заказа</h2>
                <p id="orderComposition"></p>
                <p id="orderSkills"></p>
            </div>
            <div><h2>Адрес доставки</h2><p id="deliveryAddress"></p></div>
            <div><h2>Дата и время доставки</h2><p id="deliveryDateTime"></p></div>
            <div><h2>Пожелания клиента</h2><p id="clientPreferences"></p></div>
            <div><h2>Стоимость</h2><p id="orderCost"></p></div>
        </div>
        <div class="a2"><a href="payment.html" class="btn_next">Оплатить</a></div>
    </div>
</body>
<script>

    var storedData = localStorage.getItem('orderData');
    if (storedData) {
        var orderData = JSON.parse(storedData);

        var orderNumberElement = document.getElementById('orderNumber');
        var orderCompositionElement = document.getElementById('orderComposition');
        var orderSkillsElement = document.getElementById('orderSkills');
        var deliveryAddressElement = document.getElementById('deliveryAddress');
        var deliveryDateTimeElement = document.getElementById('deliveryDateTime');
        var clientPreferencesElement = document.getElementById('clientPreferences');
        var orderCostElement = document.getElementById('orderCost');


        var dateStr = orderData.dateOfDelivery;
        var date = new Date(dateStr);
        var options = { day: 'numeric', month: 'long', year: 'numeric' };
        var formattedDate = date.toLocaleDateString('ru-RU', options);

        orderNumberElement.textContent = "1";
        orderCompositionElement.textContent = orderData.ratClass + ", " + orderData.ratColor + "крыса, 1 шт.";
        orderSkillsElement.textContent = "Кухня: " + orderData.skills.join(", ");
        deliveryAddressElement.textContent = orderData.city + " " + orderData.address;
        deliveryDateTimeElement.textContent = formattedDate + " " + orderData.timeOfDelivery;
        clientPreferencesElement.textContent = "Нет";
        orderCostElement.textContent = "1000";
    }



    var token = ""
    var storedToken = localStorage.getItem('jwtToken');
    if (storedToken) {
        token = storedToken;
    }

    // Обработка события
    var paymentButton = document.querySelector('.btn_next');
    paymentButton.addEventListener('click', function() {
        fetch('http://127.0.0.1:8080/order', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': token
            },
            body: JSON.stringify(orderData)
        })
            .then(response => response.text())
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });
</script>
</html>